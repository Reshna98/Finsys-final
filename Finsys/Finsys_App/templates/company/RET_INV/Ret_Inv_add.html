<!-- reshna-retainer-invoice -->
{% extends 'company/Fin_base.html' %}
{% block body %}
{% load static %}
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet"/>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js" defer></script>


<style>

     .select2-results__options {
      max-height: 150px; 
      overflow-y: auto; }

   
    .select2-results__options::-webkit-scrollbar {
      width: 5px;
    }

    .select2-results__options::-webkit-scrollbar-track {
      background: #f1f1f1; 
    }

    .select2-results__options::-webkit-scrollbar-thumb {
      background: #888; 
    }

    .select2-results__options::-webkit-scrollbar-thumb:hover {
      background: #555; 
    }
.select2-container--default .select2-selection--single .select2-selection__rendered {
    color: white;
    line-height: 28px
}


.select2-container--default .select2-search--dropdown .select2-search__field {
    width: 100%;
    border: none;
}


.select2-container--default  .select2-selection--single {
    cursor: pointer;
    display: block;
    height: 37px!important;
    user-select: none;
    -webkit-user-select: none;
    background-color: rgba(255, 255, 255, 0.14)!important;
    border: 1px solid rgba(255, 255, 255, 0.22)!important;
    color: white!important;
}

.select2-container--default .select2-results__option {
    color:white;
}

.select2-container--default .select2-dropdown {
    background: #15324b;
}
/* Target the scrollbar in the textarea */
textarea::-webkit-scrollbar {
  width: 5px;
}

/* Track of the scrollbar */
textarea::-webkit-scrollbar-track {
  background: #f1f1f1; 
}

/* Handle of the scrollbar */
textarea::-webkit-scrollbar-thumb {
  background: #888; 
}

/* Handle of the scrollbar on hover */
textarea::-webkit-scrollbar-thumb:hover {
  background: #555; 
}

</style>
<!-- <form action="{% url 'Fin_Create_RET_INV' %}" method="post" class="needs-validation" enctype="multipart/form-data" onsubmit="return validateForm()">
  {% csrf_token %} -->
<form action="{% url 'Fin_Create_RET_INV' %}" method="post" enctype="multipart/form-data" autocomplete="off">
    {% csrf_token %}
  <div class="page-content">
    <div class="card radius-15">
        <span class="d-flex justify-content-end p-2" style="cursor: pointer;" onclick="window.location.href=`{% url 'Fin_RET_INV_Listout' %}`"><i class="fa fa-times-circle text-white" style="font-size: 1.2rem;"></i></span>
      <div class="card-body">
        <div class="card-title">
          <center><h3 class="mb-0">ADD RETAINER INVOICE</h3></center>
        </div>
        <hr />
      </div>
    </div>
    <div class="card radius-15">
      <div class="card-body">
        <div id="ret_invoice">
            <div class="row mt-3">
                <div class="col-md-4 ">
                    <label class="col-form-label mt-2">Customer</label>
                                <div class="d-flex">
                                    <select name="customer" id="customer" class="form-control" >
                                        <option value="0">Select Customer</option>
                                        {% for c in customer %}
                                                <option value="{{ c.id }}">{{ c.title }} {{ c.first_name }} {{ c.last_name }}</option>
                                        {% endfor %}
                                    </select>
                                    <a class="btn btn-outline-secondary ml-1" role="button" data-target="#newcustomer" data-toggle="modal">+</a>
                                </div>
        



                    <label class="mt-3">GST Type</label>
                    <input type="text" class="form-control" id="gstType" name="gst_type" placeholder="GST Treatment" style="background-color: #43596c;" readonly>
                </div>

                <div class="col-md-4 mt-3">
                    <label class="">Email</label>
                    <input class="form-control" type="email" name="customerEmail" placeholder="Email" style="background-color: #43596c; color: white;" id="customerEmail" readonly>
                    <div class="mt-3" id="gstInDisplay" style="display: block;">
                        <label class="">GSTIN</label>
                        <input type="text" class="form-control" id="gstin" name="gstin" placeholder="GSTIN" style="background-color: #43596c;" readonly>
                    </div>
                </div>

                <div class="col-md-4 mt-3">
                    <label class="">Billing Address</label>
                    <textarea class="form-control" name="bill_address" id="billAddress" rows="4" style="background-color: #43596c; color: white;" readonly></textarea>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 mt-3">
                    <div class="d-flex">
                        <label class="">Retainer Invoice No.</label><span class="text-danger ml-3" id="RETno"></span>
                    </div>
                    <input type="text" class="form-control" name="ret_inv_no"  id="RETNUM" style="background-color: #43596c;" placeholder="{{invNo}}" required>
                </div>
                <div class="col-md-4 mt-3">
                    <label class="">Reference Number</label>
                    <input type="text" class="form-control" name="reference_number" value="{{ref_no}}" style="background-color: #43596c;" readonly>
                </div>
                <div class="col-md-4 mt-3">
                    <input hidden value="{{cmp.State}}" id="cmpstate">
                    <label class="">Place of supply</label>
                    <select type="text" class="form-control" id="placeOfSupply" name="place_of_supply" style="background-color: #43596c; color: white;" required>
                        <option value="" selected>--Choose--</option>
                        <option value="Andaman and Nicobar Islads">Andaman and Nicobar Islads</option>
                        <option value="Andhra Predhesh">Andhra Predhesh</option>
                        <option value="Arunachal Predesh">Arunachal Predesh</option>
                        <option value="Assam">Assam</option>
                        <option value="Bihar">Bihar</option>
                        <option value="Chandigarh">Chandigarh</option>
                        <option value="Chhattisgarh">Chhattisgarh</option>
                        <option value="Dadra and Nagar Haveli">Dadra and Nagar Haveli</option>
                        <option value="Damn anad Diu">Damn anad Diu</option>
                        <option value="Delhi">Delhi</option>
                        <option value="Goa">Goa</option>
                        <option value="Gujarat">Gujarat</option>
                        <option value="Haryana">Haryana</option>
                        <option value="Himachal Predesh">Himachal Predesh</option>
                        <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                        <option value="Jharkhand">Jharkhand</option>
                        <option value="Karnataka">Karnataka</option>
                        <option value="Kerala">Kerala</option>
                        <option value="Ladakh">Ladakh</option>
                        <option value="Lakshadweep">Lakshadweep</option>
                        <option value="Madhya Predesh">Madhya Predesh</option>
                        <option value="Maharashtra">Maharashtra</option>
                        <option value="Manipur">Manipur</option>
                        <option value="Meghalaya">Meghalaya</option>
                        <option value="Mizoram">Mizoram</option>
                        <option value="Nagaland">Nagaland</option>
                        <option value="Odisha">Odisha</option>
                        <option value="Puducherry">Puducherry</option>
                        <option value="Punjab">Punjab</option>
                        <option value="Rajasthan">Rajasthan</option>
                        <option value="Sikkim">Sikkim</option>
                        <option value="Tamil Nadu">Tamil Nadu</option>
                        <option value="Telangana">Telangana</option>
                        <option value="Tripura">Tripura</option>
                        <option value="Uttar Predesh">Uttar Predesh</option>
                        <option value="Uttarakhand">Uttarakhand</option>
                        <option value="West Bengal">West Bengal</option>
                        <option value="Other Territory">Other Territory</option>
                    </select>
                </div>
            </div>

            <div class="row">
                <div class="col-md-3 mt-3">
                    <label class="">Retainer Invoice Date:</label>
                    <input type="date" class="form-control" name="invoice_date" id="invoiceDate" style="background-color: #43596c; color: white;" value="{% now 'Y-m-d' %}">
                </div>
                

                <div class="col-md-3 mt-3">
                    <label class="">Payment Type</label>
                    <select class="form-control my-select" id="paymentMethod" name="payment_method" style="background-color: #43596c;">
                        <option value="" selected>Select Payment Method</option>
                        <option value="Cash">Cash</option>
                        <option value="Cheque">Cheque</option>
                        <option value="UPI">UPI</option>
                        {% for b in banks %}
                        <option value="{{b.bank_name}}" text="{{b.id}}">{{b.bank_name}}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-3 mt-3" style="display:none;"  id="chequediv">
                    <label class="" >Cheque No</label>
                    <input type="text" class="form-control" name="cheque_id" id="cheque_id" placeholder="Enter Cheque No">
                </div>
                <div class="col-md-3 mt-3"  style="display:none;" id="upidiv">
                    <label class="" >UPI ID</label>
                    <input type="text" class="form-control" name="upi_id" id="upi_id" placeholder="Enter UPI ID">
                </div>
                <div class="col-md-3 mt-3"  style="display:none;" id="bnkdiv">
                    <label class="" >Account#</label>
                    <input type="text" class="form-control" name="bnk_id" id="bnk_id" style="background-color: #43596c;" readonly>
                </div>
            </div>
            <div class="row clearfix ">
                <div class="col-md-12 table-responsive-md mt-3">
                    <table class="table table-bordered table-hover mt-3" id="invoiceItemsTable">
                        <thead>
                            <tr>
                                <th class="text-center">#</th>
                                <th class="text-center">PRODUCT / SERVICE</th>
                                <th class="text-center">HSN</th>
                                <th class="text-center">QTY</th>
                                <th class="text-center">PRICE</th>
                                <th class="text-center">DISCOUNT</th>
                                <th class="text-center">TOTAL</th>
                            </tr>
                        </thead>
                        <tbody id="items-table-body">
                            <tr id='tab_row1'>
                                <td class="nnum" style="text-align: center;">1</td>
                                <td style="width: 20%;">
                                    <div class="d-flex">
                                        <div class="w-100">
                                            <div class="p-0 border-0 bg-none position-relative drop-box" style="display: block;">
                                                <input required type="text" id="item1" value="" name="item_name[]" class="dropdown-toggle form-control item-display" onkeyup="filterFunction($(this).attr('id'))"  data-toggle="dropdown" aria-expanded="false" placeholder="Items.." autocomplete="off">
                                                <ul class="dropdown-menu w-100 items-available position-absolute" id="menu1"  style="overflow-y: auto; height: fit-content;max-height: 40vh;"> 
                                                    {% for i in items %}
                                                    <li class="dropdown-item items-options" onclick="getItemDetails($(this).parent().prev().attr('id'),`{{i.name}}`)">{{i.name}}</li>
                                                    {% endfor %}
                                                </ul>
                                                
                                            </div>
                                        </div>
                                        <a href="#">
                                            <button type="button" class="btn btn-outline-secondary ml-1" data-target="#newItem" data-toggle="modal">+</button>
                                        </a>
                                    </div>
                                
                                </td>
                                <td>
                                    <input type="hidden" name="item_id[]" id="itemId1">
                                    <input type="text" name='hsn[]' id="hsn1" placeholder='HSN Code' class="form-control HSNCODE" style="background-color: #43596c; color: white;" readonly />
                                </td>
                                <td >
                                    <input type="number" name='qty[]' id="qty1"  class="form-control qty mb-1" step=0 min=1 style="background-color: #43596c;margin-top: 21px; color: white;" value=0 onchange="changeItemQty(this.id)" required/>
                                    <input type="text" id="avl1" style="display: none;">
                                    <div class="d-flex"><span>Available Qty :</span><span id="qtyspan1" class=''></span></div>
                                </td>
                                <td>
                                    <input type="number" name='price[]' id="price1" class="form-control price" step="0.00" min="0" style="background-color: #43596c; color: white; display: block;" value=0 readonly />
                                    <input type="number" name='priceListPrice[]' id="priceListPrice1" class="form-control priceListPrice" step="0.00" min="0" style="background-color: #43596c; color: white;display: none;" value=0 readonly />
                                </td>
                                
            
                                <td >
                                    <input type="number" name='discount[]'  placeholder='Enter Discount' id="disc1" value=0 class="form-control disc" step=0 min=0 style="background-color: #43596c;  color: white;"  />
                                </td>

                                <td><input type="number" name='total[]' id="total1" class="form-control total" value=0 readonly style="background-color: #43596c; color: white;" /></td>
                                <td style="display: none;"><input type="hidden" id="taxamount1" class="form-control itemTaxAmount" /></td>
                                <td>
                                    <button type="button" id="1" class="btn font-weight-bold clone_row fa fa-clone px-2 my-1 py-1" title="Clone Row" style="background-color:rgb(88, 107, 143);"></button><br>
                                    <button type="button" id="1" class="btn btn-danger remove_row px-2 py-1 mx-1 fa fa-close" title="Remove Row"> </button>
                                </td>
                            </tr>
                        </tbody>
                        <tr>
                            <td style="border: none;"><a class="btn btn-outline-secondary ml-1" role="button" id="add" >+</a></td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="row clearfix" style="margin-top:20px">
                <div class="col-md-6">
                    <textarea class="form-control mt-3"  id="" name="note" placeholder="Note" style="height: 190px;"></textarea>
                    <input type="file" name="file"  style="margin-top: 10px; width: 70%;">
                </div>            
                <div class="col-md-1"></div>
                <div class="col-md-5 table-responsive-md mt-3 " id="invoiceItemsTableTotal" style="background-color:rgba(0,0,0,.4); border: 1px solid rgba(128, 128, 128, 0.6); margin-left: -2vh;">
                    <div class="p-3">
                        <div class="row container-fluid p-2 m-0">
                            <div class="col-sm-4 mt-2"><label class="text-center">Sub Total</label></div>
                            <div class="col-sm-1 mt-2">:</div>
                            <div class="col-sm-7 mt-2"><input type="number" step="any" name='subtotal' value=0.00 readonly style="background-color: #37444f;" class="form-control" id="sub_total"></div>
                        </div>
                
                        <div class="row container-fluid p-2 m-0">
                            <div class="col-sm-4 mt-2"><label for="a" class="text-center">Adjustment</label></div>
                            <div class="col-sm-1 mt-2">:</div>
                            <div class="col-sm-7 mt-2"><input type="number" step="any" name='adj' id="adj" value=0.00 class="form-control"/></div>
                        </div>
                        <div class="row container-fluid p-2 m-0">
                            <div class="col-sm-4 mt-2"><label for="a" class="text-center">Grand Total</label></div>
                            <div class="col-sm-1 mt-2">:</div>
                            <div class="col-sm-7 mt-2"><input type="number" name='grandtotal' id="grandtotal" value=0.00 readonly style="background-color: #37444f;" class="form-control"/></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-7"></div>
                <div class="col-md-5 table-responsive-md mt-3 " id="invoiceItemsTablePaid" style="background-color:rgba(0,0,0,.4); border: 1px solid rgba(128, 128, 128, 0.6); margin-left: -2vh;">
                    <div class="p-3">
                        <div class="row container-fluid p-2 m-0">
                            <div class="col-sm-4 mt-2"><label for="a" class="text-center">Paid Off</label></div>
                            <div class="col-sm-1 mt-2">:</div>
                            <div class="col-sm-7 mt-2"><input type="number" step="any" name='advance' id="advance"  value=0.00 class="form-control"/></div>
                        </div>
                        <div class="row container-fluid p-2 m-0">
                            <div class="col-sm-4 mt-2"><label for="a" class="text-center">Balance</label></div>
                            <div class="col-sm-1 mt-2">:</div>
                            <div class="col-sm-7 mt-2"><input type="number" name='balance' id="balance" value=0.00 readonly style="background-color: #37444f;" class="form-control" readonly /></div>
                        </div>
                    </div>
                </div>
            </div>

        
            <div class="row">
                <div class="col-md-7 mt-3">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="agreeTerms" required style="background-color: #43596c;">
                        <label for="agreeTerms">Agree to terms and conditions</label>
                        <div class="invalid-feedback">You must agree before submitting.</div>
                    </div>
                </div>
                <div class="col-md-5 mt-3 d-flex">
                    <input type="submit" class="btn btn-outline-secondary w-50 text-light" name="Draft" value="Draft">
                    <input type="submit" class="btn btn-outline-secondary w-50 ml-1 text-light" name="Save" value="Save">
                </div>
            </div>
            <div class="notices mt-3">
                <div class="text-muted">NOTICE:</div>
                <div class="text-muted">Fin sYs Terms and Conditions Apply</div>
            </div>
            <footer class="text-muted">Invoice was created on a computer and is valid without the signature and seal.</footer>
        </div>
      </div>
    </div>
  </div>
</form>



<!-- New Cust Payment Term Modal -->

<div class="modal fade" id="CustomerPTerm">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" style="background-color: #213b52;">
            <div class="modal-header">
                <h5 class="m-3">New Customer Payment Term</h5>
                <button type="button" class="close" data-toggle="modal" data-target="#newcustomer" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="card p-3">
                    <form method="post" id="cust_PT">
                        {% csrf_token %}
                        <div class="row mt-2">
                            <div class="col-6">
                                <label for="name">Term Name</label>
                                <input type="text" name="term_name" id="custTermName" class="form-control w-100">
                            </div>
                            <div class="col-6">
                                <label for="name">Days</label>
                                <input type="number" name="days" id="custTermDays" class="form-control w-100" min="0" step="1">
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-4"></div>
                            <div class="col-4 d-flex justify-content-center">
                                <button class="btn btn-outline-secondary text-grey w-75" data-toggle="modal" data-target="#newcustomer" type="button" id="savePT">Save</button>
                            </div>
                            <div class="col-4"></div>
                        </div>
                    </form>
                </div>
            </div>
        </div>   
    </div>
</div>


<!-- New Customer Modal -->

<div class="modal fade" id="newcustomer">
    <div class="modal-dialog modal-xl">
        <div class="modal-content" style="background-color: #213b52;">
            <div class="modal-header">
                <h5 class="m-3">New Customer</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="card p-3">
                    <form method="post" id="Modalcustomer">
                        {% csrf_token %}
                        <div class="row mt-3">
                            <div class="col-md-4">
                                <label for="title">Title</label>
                                <select name="title" id="title" class="form-control">
                                    <option value="Mr">Mr</option>
                                    <option value="Mrs">Mrs</option>
                                    <option value="Miss">Miss</option>
                                    <option value="Ms">Ms</option>
                                </select>
                                <div class="valid-feedback">Looks good!</div>
                            </div>
                            <div class="col-md-4">
                                <label for="firstName">First Name</label>
                                <input type="text" class="form-control" id="firstName" name="first_name" required style="background-color: #43596c;color: white;">
                                <div class="valid-feedback">Looks good!</div>
                            </div>
                            <div class="col-md-4">
                                <label for="lastName">Last Name</label>
                                <input type="text" class="form-control" id="lastName" name="last_name" required style="background-color: #43596c;color: white;">
                                <div class="valid-feedback">Looks good!</div>
                            </div>
                        </div>
    
                        <div class="row mt-3">
                            <div class="col-md-4">
                                <label for="companyName">Company</label>
                                <input type="text" class="form-control" id="companyName" name="company_name" style="background-color: #43596c;color: white;">
                                <div class="valid-feedback">Looks good!</div>
                            </div>
                            <div class="col-md-4">
                                <label for="location">Location</label>
                                <input type="text" class="form-control" id="location" name="location" style="background-color: #43596c;color: white;">
                                <div class="valid-feedback">Looks good!</div>
                            </div>
                            <div class="col-md-4">
                                <label for="placeOfSupply">Place of Supply</label>
                                <select class="custom-select form-control" id="placeOfSupplyC" name="place_of_supply" style="background-color: #43596c; color: white;" required>
                                    <option selected value="">Select Place of Supply</option>
                                    <option value="Andaman and Nicobar Islads">Andaman and Nicobar Islands</option>
                                    <option value="Andhra Predhesh">Andhra Predhesh</option>
                                    <option value="Arunachal Predesh">Arunachal Predesh</option>
                                    <option value="Assam">Assam</option>
                                    <option value="Bihar">Bihar</option>
                                    <option value="Chandigarh">Chandigarh</option>
                                    <option value="Chhattisgarh">Chhattisgarh</option>
                                    <option value="Dadra and Nagar Haveli">Dadra and Nagar Haveli</option>
                                    <option value="Damn anad Diu">Damn anad Diu</option>
                                    <option value="Delhi">Delhi</option>
                                    <option value="Goa">Goa</option>
                                    <option value="Gujarat">Gujarat</option>
                                    <option value="Haryana">Haryana</option>
                                    <option value="Himachal Predesh">Himachal Predesh</option>
                                    <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                                    <option value="Jharkhand">Jharkhand</option>
                                    <option value="Karnataka">Karnataka</option>
                                    <option value="Kerala">Kerala</option>
                                    <option value="Ladakh">Ladakh</option>
                                    <option value="Lakshadweep">Lakshadweep</option>
                                    <option value="Madhya Predesh">Madhya Predesh</option>
                                    <option value="Maharashtra">Maharashtra</option>
                                    <option value="Manipur">Manipur</option>
                                    <option value="Meghalaya">Meghalaya</option>
                                    <option value="Mizoram">Mizoram</option>
                                    <option value="Nagaland">Nagaland</option>
                                    <option value="Odisha">Odisha</option>
                                    <option value="Puducherry">Puducherry</option>
                                    <option value="Punjab">Punjab</option>
                                    <option value="Rajasthan">Rajasthan</option>
                                    <option value="Sikkim">Sikkim</option>
                                    <option value="Tamil Nadu">Tamil Nadu</option>
                                    <option value="Telangana">Telangana</option>
                                    <option value="Tripura">Tripura</option>
                                    <option value="Uttar Predesh">Uttar Predesh</option>
                                    <option value="Uttarakhand">Uttarakhand</option>
                                    <option value="West Bengal">West Bengal</option>
                                    <option value="Other Territory">Other Territory</option>
                                </select>
                                <div class="invalid-feedback">Please select a valid registration type.</div>
                            </div>
                        </div>
    
                        
                    <div class="row mt-3">
                        <div class="col-md-4">
                            <label for="gsttype">GST Type</label>
                            <select class="form-control" id="gsttype" name="gst_type"  style="background-color: #43596c; color: white;" required>
                                <option selected value="">Select GST Type</option>
                                <option value="Registered Business - Regular">Registered Business - Regular <span><i>(Business that is registered under gst)</i></span></option>
                                <option value="Registered Business - Composition">Registered Business - Composition (Business that is registered under composition scheme in gst)</option>
                                <option value="Unregistered Business">Unregistered Business (Business that has not been registered under gst)</option>
                                <option value="Overseas">Overseas (Import/Export of supply outside india)</option>
                                <option value="Consumer">Consumer</option>
                                <option value="Special Economic Zone (SEZ)">Special Economic Zone (SEZ) (Business that is located in a special economic zone of india or a SEZ developer)</option>
                                <option value="Demed Exports">Demed Exports (Supply of woods to an exports oriented unit or againsed advanced authorization or export promotion capital woods)</option>
                                <option value="Tax Deductor">Tax Deductor (State of central gov,government agencies or local authority)</option>
                                <option value="SEZ Developer">SEZ Developer (A person or organization who owns atleast 26% equality in creating business units in special economic zone)</option>
                            </select>
                            <div class="invalid-feedback">Please select a valid registration type.</div>
                        </div>

                        <div class="col-md-4 gstrow d-block" id="gstInValue">
                            <div>
                                <label for="gstIn">GSTIN</label>
                                <input type="text" class="form-control" onchange="checkgst(this)" id="gstIn" name="gstin" style="background-color: #43596c;color: white;" placeholder="29APPCK7465F1Z1">
                                <a data-toggle="modal" href="#exampleModal" style="color:#3dd5f3">Get Taxpayer Details</a>
                                <div class="text-danger m-2" id="warngst"></div>
                            </div>
                        </div>
     
                            <div class="col-md-4">
                                <label for="panNo">PAN No.</label>
                                <input type="text" class="form-control" id="panNo" name="pan_no" style="background-color: #43596c;color: white;" required onchange="checkpan(this)" placeholder="APPCK7465F">
                                <div class="text-danger m-2" id="warnpan"></div>
                            </div>
                        </div>
    
                        <div class="row">
                            <div class="col-md-4 mt-3">
                                <label for="validationCustom05">Opening Balance</label>
                                <div class="d-flex">
                                    <select name="balance_type" id="bal" class="form-select text-white mr-1" style="background-color: #243e54; width: 25%; border-radius: 5px;">
                                        <option value="debit">Debit</option>
                                        <option value="credit">Credit</option>
                                    </select>
                                    <input type="text" class="form-control" name="open_balance" id="openbalance" step="any" style="background-color: #43596c;color: white;">
                                    <div class="text-danger m-2" ></div>
                                </div>
                            </div>
    
                            <div class="col-md-4 mt-3">
                                <label for="creditLimit">Credit Limit</label>
                                <input type="text" class="form-control" name="credit_limit" style="background-color: #43596c;color: white;" step="any" id="creditLimit">
                                <div class="text-danger m-2" ></div>
                            </div>
    
                            <div class="col-md-4 mt-3">
                                <label for="paymentTerms">Payment Terms</label>
                                <div class="d-flex">
                                    <select name="payment_terms" id="paymentTerms" class="form-control">
                                        <option value="" selected>Choose</option>
                                        {% for p in pterm %}
                                        <option value="{{p.id}}">{{p.term_name}}</option>
                                        {% endfor %}
                                    </select>
                                    <a href="#CustomerPTerm" data-dismiss="modal" data-toggle="modal" class="btn btn-outline-secondary ml-1">+</a>
                                </div>
                            </div>
    
                            <div class="col-md-4 mt-3">
                                <label for="priceList">Price List</label>
                                <select name="price_list" id="priceList" class="form-control">
                                    <option value="" selected>Choose</option>
                                    {% for l in list %}
                                    <option value="{{l.id}}">{{l.name}}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
    
                        <div class="row mt-3">
                            <div class="col-md-4">
                                <label for="custEmail">Email</label>
                                <input type="email" class="form-control" required id="custEmail" name="email" onchange="checkemail(this)" style="background-color: #43596c;color: white;" placeholder="finsys@gmail.com">
                                <div id="warnemail" class="text-danger"></div>
                            </div>
                            <div class="col-md-4">
                                <label for="custWebsite">Website</label>
                                <input type="text" class="form-control" id="custWebsite" required placeholder="www.finsys.com" onchange="checkweb(this)" name="website" style="background-color: #43596c;color: white;">
                                <div id="warnweb" class="text-danger"></div>
                            </div>
                            <div class="col-md-4">
                                <label for="custMobile">Mobile</label>
                                <input type="text" class="form-control" id="custMobile" required onchange="checkphone(this)" name="mobile" style="background-color: #43596c;color: white;">
                                <div class="text-danger m-2" id="warnphone"></div>
                            </div>
                        </div>
                        <hr>
                        <div class="row mt-5">
                            <div class="col-md-6">
                                <div class="row">
                                    <div class="col-md-12 card-title">
                                        <h5 class="mb-0">Billing Address</h5>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12 mt-3">
                                        <div class="form-row">
                                            <label for="street">Street</label>
                                            <textarea class="form-control street" required id="street" name="street" style="background-color: #43596c;color: white;"></textarea>
                                            <div class="invalid-feedback">Please provide a valid Street</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mt-3">
                                        <div class="form-row">
                                            <label for="city">City</label>
                                            <input type="text" class="form-control" required id="city" name="city" style="background-color: #43596c;color: white;" placeholder="City">
                                            <div class="invalid-feedback">Please provide a valid City</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mt-3">
                                        <div class="form-row">
                                            <label for="state">State</label>
                                            <select type="text" class="form-control" id="state" name="state" required style="background-color: #43596c; color: white;">
                                                <option value="" selected hidden>Choose</option>
                                                <option value="Andaman and Nicobar Islads">Andaman and Nicobar Islands</option>
                                                <option value="Andhra Predhesh">Andhra Predhesh</option>
                                                <option value="Arunachal Predesh">Arunachal Predesh</option>
                                                <option value="Assam">Assam</option>
                                                <option value="Bihar">Bihar</option>
                                                <option value="Chandigarh">Chandigarh</option>
                                                <option value="Chhattisgarh">Chhattisgarh</option>
                                                <option value="Dadra and Nagar Haveli">Dadra and Nagar Haveli</option>
                                                <option value="Damn anad Diu">Damn anad Diu</option>
                                                <option value="Delhi">Delhi</option>
                                                <option value="Goa">Goa</option>
                                                <option value="Gujarat">Gujarat</option>
                                                <option value="Haryana">Haryana</option>
                                                <option value="Himachal Predesh">Himachal Predesh</option>
                                                <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                                                <option value="Jharkhand">Jharkhand</option>
                                                <option value="Karnataka">Karnataka</option>
                                                <option value="Kerala">Kerala</option>
                                                <option value="Ladakh">Ladakh</option>
                                                <option value="Lakshadweep">Lakshadweep</option>
                                                <option value="Madhya Predesh">Madhya Predesh</option>
                                                <option value="Maharashtra">Maharashtra</option>
                                                <option value="Manipur">Manipur</option>
                                                <option value="Meghalaya">Meghalaya</option>
                                                <option value="Mizoram">Mizoram</option>
                                                <option value="Nagaland">Nagaland</option>
                                                <option value="Odisha">Odisha</option>
                                                <option value="Puducherry">Puducherry</option>
                                                <option value="Punjab">Punjab</option>
                                                <option value="Rajasthan">Rajasthan</option>
                                                <option value="Sikkim">Sikkim</option>
                                                <option value="Tamil Nadu">Tamil Nadu</option>
                                                <option value="Telangana">Telangana</option>
                                                <option value="Tripura">Tripura</option>
                                                <option value="Uttar Predesh">Uttar Predesh</option>
                                                <option value="Uttarakhand">Uttarakhand</option>
                                                <option value="West Bengal">West Bengal</option>
                                                <option value="Other Territory">Other Territory</option>
                                            </select>
                                            <div class="invalid-feedback">Please provide a valid State</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mt-3">
                                        <div class="form-row">
                                            <label for="pinco">Pin Code</label>
                                            <input type="text" class="form-control" required id="pinco" name="pincode" style="background-color: #43596c;color: white;" placeholder="PIN code">
                                            <div class="invalid-feedback">Please provide a valid Pin Code</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mt-3">
                                        <div class="form-row">
                                            <label for="country">Country</label>
                                            <input type="text" class="form-control" required id="country" name="country" style="background-color: #43596c;color: white;" placeholder="Country">
                                            <div class="invalid-feedback">Please provide a valid Country</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="row">
                                    <div class="col-md-12 d-flex">
                                        <h5>Shipping Address</h5>
                                        <input class="ml-4 ml-5" type="checkbox" onclick="placeShipAddress()" id="shipAddress" name="ship_address">
                                        <label class="ml-2 mt-1 ml-2" for="shipAddress">Same As Billing Address</label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12 mt-3">
                                        <div class="form-row">
                                            <label for="shipstreet">Street</label>
                                            <textarea class="form-control" id="shipstreet" name="shipstreet" style="background-color: #43596c;color: white;"></textarea>
                                            <div class="invalid-feedback">Please provide a valid Street</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mt-3">
                                        <div class="form-row">
                                            <label for="shipcity">City</label>
                                            <input type="text" class="form-control" id="shipcity" name="shipcity" style="background-color: #43596c;color: white;" placeholder="City">
                                            <div class="invalid-feedback">Please provide a valid City</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mt-3">
                                        <div class="form-row">
                                            <label for="shipstate">State</label>
                                            <select type="text" class="form-control" id="shipState" name="shipstate" style="background-color: #43596c; color: white;">
                                                <option value="" selected>Choose</option>
                                                <option value="Andaman and Nicobar Islads">Andaman and Nicobar Islands</option>
                                                <option value="Andhra Predhesh">Andhra Predhesh</option>
                                                <option value="Arunachal Predesh">Arunachal Predesh</option>
                                                <option value="Assam">Assam</option>
                                                <option value="Bihar">Bihar</option>
                                                <option value="Chandigarh">Chandigarh</option>
                                                <option value="Chhattisgarh">Chhattisgarh</option>
                                                <option value="Dadra and Nagar Haveli">Dadra and Nagar Haveli</option>
                                                <option value="Damn anad Diu">Damn anad Diu</option>
                                                <option value="Delhi">Delhi</option>
                                                <option value="Goa">Goa</option>
                                                <option value="Gujarat">Gujarat</option>
                                                <option value="Haryana">Haryana</option>
                                                <option value="Himachal Predesh">Himachal Predesh</option>
                                                <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                                                <option value="Jharkhand">Jharkhand</option>
                                                <option value="Karnataka">Karnataka</option>
                                                <option value="Kerala">Kerala</option>
                                                <option value="Ladakh">Ladakh</option>
                                                <option value="Lakshadweep">Lakshadweep</option>
                                                <option value="Madhya Predesh">Madhya Predesh</option>
                                                <option value="Maharashtra">Maharashtra</option>
                                                <option value="Manipur">Manipur</option>
                                                <option value="Meghalaya">Meghalaya</option>
                                                <option value="Mizoram">Mizoram</option>
                                                <option value="Nagaland">Nagaland</option>
                                                <option value="Odisha">Odisha</option>
                                                <option value="Puducherry">Puducherry</option>
                                                <option value="Punjab">Punjab</option>
                                                <option value="Rajasthan">Rajasthan</option>
                                                <option value="Sikkim">Sikkim</option>
                                                <option value="Tamil Nadu">Tamil Nadu</option>
                                                <option value="Telangana">Telangana</option>
                                                <option value="Tripura">Tripura</option>
                                                <option value="Uttar Predesh">Uttar Predesh</option>
                                                <option value="Uttarakhand">Uttarakhand</option>
                                                <option value="West Bengal">West Bengal</option>
                                                <option value="Other Territory">Other Territory</option>
                                            </select>
                                            <div class="invalid-feedback">Please provide a valid State</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mt-3">
                                        <div class="form-row">
                                            <label for="shippinco">Pin Code</label>
                                            <input type="text" class="form-control" id="shippinco" name="shippincode" style="background-color: #43596c;color: white;" placeholder="PIN code">
                                            <div class="invalid-feedback">Please provide a valid Pin Code</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mt-3">
                                        <div class="form-row">
                                            <label for="shipcountry">Country</label>
                                            <input type="text" class="form-control" id="shipcountry" name="shipcountry" style="background-color: #43596c;color: white;" placeholder="Country">
                                            <div class="invalid-feedback">Please provide a valid Country</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="" id="agreeTerms" required style="background-color: #43596c;">
                                    <label for="agreeTerms">Agree to Terms and Conditions</label>
                                    <div class="invalid-feedback">You must agree before submitting.</div>
                                </div>
                            </div>
                        </div>

                        <div class="row mt-4">
                            <div class="col-4"></div>
                            <div class="col-4 d-flex justify-content-center">
                                <button class="btn btn-outline-secondary text-grey w-75" data-dismiss="modal" type="button" id="customerSave">Save</button>
                            </div>
                            <div class="col-4"></div>
                        </div>
                    </form>
                </div>
            </div>
        </div>   
    </div>
</div>








   <!-- Customer -->
<script>
$(document).ready(function() {
    $('#customer').select2();
   
});


    function placeShipAddress() {
        var chkbtn = document.getElementById('shipAddress');
        if (chkbtn.checked == true) {
            document.getElementById('shipstreet').value = document.getElementById('street').value;
            document.getElementById('shipcity').value = document.getElementById('city').value;
            document.getElementById('shippinco').value = document.getElementById('pinco').value;
            document.getElementById('shipcountry').value = document.getElementById('country').value;
            document.getElementById('shipState').value = document.getElementById('state').value;
        } else {
            document.getElementById('shipstreet').value = '';
            document.getElementById('shipcity').value = '';
            document.getElementById('shippinco').value = '';
            document.getElementById('shipcountry').value = '';
            document.getElementById('shipState').value = '';
            
        }
    }

    $(document).on("click","#savePT",function(){
        var trm = $('#custTermName').val();
        var dys = $("#custTermDays").val();
        if (trm !="" && dys !=""){
            $.ajax({
                type : 'POST',
                url:"{% url 'Fin_Retinvcustomer_paymentterm' %}",
                data:{
                    'term' : trm,
                    'days' : dys,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                
                success: function(response) {
                    if(response.status){
                        document.getElementById("cust_PT").reset();
                        
                        var dropdown = $('#paymentTerms');
                        dropdown.empty();
                        dropdown.append(`<option value="" selected>Choose</option>`);
                        $.each(response, function(key, value) {
                            for(let i=0; i<value.length; i++){
                                if(value[i].name == trm){
                                    dropdown.append($('<option selected></option>').text(value[i].name).val(value[i].id))
                                }else{
                                    dropdown.append($('<option></option>').text(value[i].name).val(value[i].id))
                                }   
                            }
                        });

                    }else{
                        alert("Something went wrong.!")
                    }
                },         
            });
        }else{
            alert('Invalid')
        }
    });
    
    $(document).ready(function() {
        $("#gsttype").change(function() {
            var x=$('#gsttype').val();
            if(x == "Unregistered Business" || x == 'Overseas' || x == 'Consumer'){
                $(".gstrow").removeClass('d-block');
                $(".gstrow").addClass('d-none');
                $('#gstIn').prop('required',false);
            }else {
                $('#gstIn').prop('required',true);
                $(".gstrow").removeClass('d-none');
                $(".gstrow").addClass('d-block');
            }
        });
    });

        
    function showMessage(input) {
        const gstin = input.value;

        if (gstin.length === 15) {
            // document.getElementById("message").textContent = "Please wait, validating GSTIN format...";
            setTimeout(() => checkgst(input), 1000);  // Wait for a second and then validate GSTIN
        } else {
            document.getElementById("message").textContent = "";
        }
    }

    function checkgst(element) {
        var gstinput = element.value;
        var gstregexp = "[0-9]{2}[a-zA-Z]{5}[0-9]{4}[a-zA-Z]{1}[1-9A-Za-z]{1}[Z]{1}[0-9a-zA-Z]{1}";

        if (gstinput.length === 15) {
            if (gstinput.match(gstregexp)) {
                document.getElementById('warngst').innerHTML = '';
                checkCustomerGSTIN(gstinput)
            } else {
                document.getElementById('warngst').innerHTML = 'Please provide a valid GST Number';
                alert('Please provide a valid GST Number');
            }
        }
            else {
            document.getElementById('warngst').innerHTML = 'Please provide a valid GST Number';
            alert('Please provide a valid GST Number');
        }
    }

    function checkpan(element) {
        var paninput = element.value;
        var panregexp = ["[a-zA-Z]{5}[0-9]{4}[a-zA-Z]{1}"]
        if (paninput.match(panregexp)) {
            document.getElementById('warnpan').innerHTML = '';
            checkCustomerPAN(paninput)
        } else {
            document.getElementById('warnpan').innerHTML = 'Please provide a valid PAN Number';
            alert('Please provide a valid PAN Number')
        }
    }

    function checkweb(element) {
        var webinput = element.value;
        var webregexp = "www."
        if (webinput.startsWith(webregexp)) {
            document.getElementById('warnweb').innerHTML = '';
        } else {
            document.getElementById('warnweb').innerHTML = 'Please provide a valid Website Address';
            alert('Please provide a valid Website Address')
        }
    }

    function checkphone(element) {
        var phoneinput = element.value;
        var phoneregexp = /^\d{10}$/;
        if (phoneinput.match(phoneregexp)) {
            document.getElementById('warnphone').innerHTML = '';
            checkCustomerPhone(phoneinput)
        } else {
            document.getElementById('warnphone').innerHTML = 'Please provide a valid Phone Number';
            alert('Please provide a valid Phone Number')
        }
    }

    function checkemail(element) {
        var emailinput = element.value;
        var emailregexp = /^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/;
        if (emailinput.match(emailregexp)) {
            document.getElementById('warnemail').innerHTML = '';
            checkCustomerEmail(emailinput)
        } else {
            document.getElementById('warnemail').innerHTML = 'Please provide a valid Email ID';
            alert('Please provide a valid Email id')
        }
    }

    $(document).on('change', '#openbalance',function () {
        openbal = $("#openbalance").val()
        if($('#bal').val()=='credit'){
            if(openbal.slice(0,1) != '-'){
                if(parseFloat(openbal) != 0){
                    document.getElementById("openbalance").value = "-"+openbal
                }else{
                    document.getElementById("openbalance").value = openbal
                }
            }else{
                if(parseFloat(openbal) != 0){
                    document.getElementById("openbalance").value = openbal
                }else{
                    document.getElementById("openbalance").value = -1 * parseFloat(openbal)
                }
            }
        }else{
            document.getElementById("openbalance").value = openbal
        }
    });

    $(document).on('change', '#bal',function () {
        openbal = $("#openbalance").val()
        if(openbal != ""){
            if($('#bal').val()=='credit'){
                openbal = $("#openbalance").val()
                if (parseFloat(openbal) != 0){
                    document.getElementById("openbalance").value = "-"+openbal
                }else{
                    document.getElementById("openbalance").value = openbal
                }
            }else{
                openbal = $("#openbalance").val()
                document.getElementById("openbalance").value = -1*(parseFloat(openbal))
            }
        }
    });

    $(document).ready(function(){
        $('#lastName').on('change',()=>{
            var fName = $('#firstName').val().replace(/\d/g, '');
            var lName = $('#lastName').val().replace(/\d/g, '');
            if(fName !="" && lName !=""){
                checkCustomerName(fName,lName)
            }else{
                alert('Please enter a valid Full Name.!')
                return false
            }
        });

        $('#firstName').on('change',()=>{
            var fName = $('#firstName').val().replace(/\d/g, '');
            var lName = $('#lastName').val().replace(/\d/g, '');
            if(fName !="" && lName !=""){
                checkCustomerName(fName,lName)
            }else if(fName == "" && lName !=""){
                alert('Please enter a valid First Name.!')
            }

        })
    });

    function checkCustomerName(fname,lname){
        if (fname != "" && lname !=""){
            $.ajax({
                type : 'POST',
                url:"{% url 'Fin_checkCustomerName' %}",
                data:{
                    'fname' : fname,
                    'lname' : lname,

                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                
                success: function(response) {
                    if(response.is_exist){
                        alert(response.message)
                    }
                },         
            });
        }
    }

    function checkCustomerGSTIN(gstin){
        var gstNo = gstin;
        if (gstNo != ""){
            $.ajax({
                type : 'POST',
                url:"{% url 'Fin_checkCustomerGSTIN' %}",
                data:{
                    'gstin' : gstNo,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                
                success: function(response) {
                    if(response.is_exist){
                        alert(response.message)
                    }
                },         
            });
        }
    }

    function checkCustomerPAN(pan){
        var panNo = pan;
        if (panNo != ""){
            $.ajax({
                type : 'POST',
                url:"{% url 'Fin_checkCustomerPAN' %}",
                data:{
                    'pan' : panNo,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                
                success: function(response) {
                    if(response.is_exist){
                        alert(response.message)
                    }
                },         
            });
        }
    }

    function checkCustomerPhone(phone){
        var phoneNo = phone;
        if (phoneNo != ""){
            $.ajax({
                type : 'POST',
                url:"{% url 'Fin_checkCustomerPhone' %}",
                data:{
                    'phone' : phoneNo,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                
                success: function(response) {
                    if(response.is_exist){
                        alert(response.message)
                    }
                },         
            });
        }
    }

    function checkCustomerEmail(email){
        var custEmail = email;
        if (custEmail != ""){
            $.ajax({
                type : 'POST',
                url:"{% url 'Fin_checkCustomerEmail' %}",
                data:{
                    'email' : custEmail,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                
                success: function(response) {
                    if(response.is_exist){
                        alert(response.message)
                    }
                },         
            });
        }
    }

    $(document).on("click", "#customerSave", function(){
        var fName = $('#firstName').val();
        var lName = $('#lastName').val();
        var placeSupply = $('#placeOfSupplyC').val();
        var gstType = $("#gsttype").val();
        var gstIN = $("#gstIn").val();
        var panNo = $("#panNo").val();
        var Email = $("#custEmail").val();
        var Mob = $("#custMobile").val();
        var street = $("#street").val();
        var city = $("#city").val();
        var state = $("#state").val();
        var pin = $("#pinco").val();
        var country = $("#country").val();
        if(gstType != "Unregistered Business" && gstType != 'Overseas' && gstType != 'Consumer' && gstIN == ""){
            alert('Fill all required fields..!')
            return
        }

        if(fName != "" && lName != "" && placeSupply != "" && gstType != "" && panNo != "" && Email != "" && Mob != "" && street != "" && city != "" && state != "" && pin != "" && country != ""){
        
    $.ajax({
        type: 'POST',
        url: "{% url 'Fin_RET_INV_Customer' %}",
        data: {
            title: $('#title').val(),
            first_name : fName,
            last_name : lName,
            company_name: $("#companyName").val(),
            location: $("#location").val(),
            place_of_supply : placeSupply,
            gst_type : gstType,
            gstin : gstIN,
            pan_no : panNo,
            price_list: $('#priceList').val(),
            payment_terms: $('#paymentTerms').val(),
            open_balance: $("#openbalance").val(),
            balance_type: $("#bal").val(),
            credit_limit: $("#creditLimit").val(),
            email : Email,
            website :$("#custWebsite").val(),
            mobile : Mob,
            street : street,
            city: $("#city").val(),
            state: $("#state").val(),
            country: $("#country").val(),
            pincode: $("#pinco").val(),
            shipstreet: $("#shipstreet").val(),
            shipcity: $("#shipcity").val(),
            shipstate: $("#shipState").val(),
            shipcountry: $("#shipcountry").val(),
            shippincode: $("#shippinco").val(),
            csrfmiddlewaretoken: '{{ csrf_token }}',
        },
        success: function(response) {
            if(response.status){
                console.log("AJAX Success", response);
                $("#Modalcustomer").trigger("reset");
                reloadcustomer();
            } else {
                alert(response.message);
            }
        },
    });
}
    else{
            alert('Fill all required fields..!')
            return
        }
});
function reloadcustomer() {
    $.ajax({
        url: "{% url 'Fin_get_RET_INV_Customers' %}",
        type: "GET",
        dataType: "json",
        data: {},
        csrfmiddlewaretoken: '{{ csrf_token }}',

        success: function(data) {
            var dropdown = $('#customer');
            dropdown.empty();
            dropdown.append(`<option value="0" selected>Select Customer</option>`);
            $.each(data, function(key, value) {
                console.log("Appending option:", value[1] + " " + value[2] + " " + value[3]);
                dropdown.append($('<option selected></option>').attr('value', value[0]).text(value[1] + " " + value[2] + " " + value[3]));
            });

            $('#customer').trigger('change');
        
        },
        error: function(xhr, status, error) {
            console.error(xhr.responseText);
        }
    });

    if ($('#CustomerPTerm').hasClass('show')) {
        $('#CustomerPTerm').modal('toggle');
    }
}


    $(document).ready(function() {
    $('#newcustomer').on('hidden.bs.modal', function () {
        if ($('#CustomerPTerm').hasClass('show')) {
            $('#CustomerPTerm').modal('hide');
        }
    });

});

function fetchCustomerDetails(customerId) {
    $.ajax({
        type: 'POST',
        url: "{% url 'Fin_RETINV_CustomerData' %}",
        data: {
            'id': customerId,
            csrfmiddlewaretoken: '{{ csrf_token }}'
        },
        success: function(data) {
    $('#gstType').val(data.gsttype);
    $('#customerEmail').val(data.email);
    $('#gstin').val(data.gstno);
    $('#placeOfSupply').val(data.placesupply); 
    $('#billAddress').val(data.street + '\n' + data.city + '\n' + data.state + '\n' + data.pincode +  '\n'+ data.country);
    if(data.gstno){
        console.log("GSTIN exists");
        document.getElementById('gstInDisplay').style.display = 'block';
        document.getElementById('gstin').value = data.gstno;
    }else{
        console.log("GSTIN does not exist");
        document.getElementById('gstInDisplay').style.display = 'none';
        document.getElementById('gstin').value = '';
    }
 

},

    });
}
$(document).ready(function() {
    $('#customer').change(function() {
        var customerId = $(this).val();
        fetchCustomerDetails(customerId);
    });
});


</script>





{% endblock %}